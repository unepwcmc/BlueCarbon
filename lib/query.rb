class Query
  def self.add(table_name)
    <<-SQL
      INSERT INTO #{table_name} (the_geom)
        SELECT
         ST_Multi(CASE WHEN existing_validations.the_geom IS NOT NULL THEN 
           ST_Difference(
             ST_GeomFromText('MULTIPOLYGON(((36.560096740722656 -18.550416726315852,36.56816482543945 -18.563435634003167,36.58069610595703 -18.55155592038031,36.560096740722656 -18.550416726315852)))', 4326),
             ST_Multi(existing_validations.the_geom))
         ELSE
           ST_GeomFromText('MULTIPOLYGON(((36.560096740722656 -18.550416726315852,36.56816482543945 -18.563435634003167,36.58069610595703 -18.55155592038031,36.560096740722656 -18.550416726315852)))', 4326)
         END) FROM (
         SELECT ST_Union(the_geom) as the_geom
         FROM #{table_name}
         WHERE ST_Intersects(ST_GeomFromText('MULTIPOLYGON(((36.560096740722656 -18.550416726315852,36.56816482543945 -18.563435634003167,36.58069610595703 -18.55155592038031,36.560096740722656 -18.550416726315852)))', 4326), the_geom)
        ) as existing_validations;
    SQL
  end
end
